272b91ef6db0e9eed1f6b2b59dd2f127
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// Mock do UserService
jest.mock('../../src/services/userService');
const userService_1 = require("../../src/services/userService");
const mockUserService = userService_1.UserService;
describe('UserController', () => {
    let userController;
    let mockRequest;
    let mockResponse;
    let mockUserServiceInstance;
    beforeEach(() => {
        // Criar instância mockada do UserService
        mockUserServiceInstance = {
            createUser: jest.fn(),
            getAllUsers: jest.fn(),
            getUserById: jest.fn(),
            updateUser: jest.fn(),
            deleteUser: jest.fn(),
            authenticateUser: jest.fn(),
            createCustomer: jest.fn(),
        };
        // Mock do UserController para usar nossa instância mockada
        userController = {
            createUser: jest.fn().mockImplementation(async (req, res) => {
                try {
                    const user = await mockUserServiceInstance.createUser(req.body);
                    res.status(201).json({
                        id: user.id,
                        name: user.name,
                        mail: user.mail,
                        login: user.login,
                        role: user.role
                    });
                }
                catch (error) {
                    res.status(400).json({ error: error.message });
                }
            }),
            getAllUsers: jest.fn().mockImplementation(async (req, res) => {
                try {
                    const users = await mockUserServiceInstance.getAllUsers();
                    res.json(users);
                }
                catch (error) {
                    res.status(500).json({ error: error.message });
                }
            }),
            getUserById: jest.fn().mockImplementation(async (req, res) => {
                try {
                    const user = await mockUserServiceInstance.getUserById(parseInt(req.params.id));
                    res.json(user);
                }
                catch (error) {
                    res.status(404).json({ error: error.message });
                }
            }),
            updateUser: jest.fn().mockImplementation(async (req, res) => {
                try {
                    const user = await mockUserServiceInstance.updateUser(parseInt(req.params.id), req.body);
                    res.json({
                        id: user.id,
                        name: user.name,
                        mail: user.mail,
                        role: user.role
                    });
                }
                catch (error) {
                    res.status(404).json({ error: error.message });
                }
            }),
            deleteUser: jest.fn().mockImplementation(async (req, res) => {
                try {
                    const result = await mockUserServiceInstance.deleteUser(parseInt(req.params.id));
                    res.json(result);
                }
                catch (error) {
                    res.status(404).json({ error: error.message });
                }
            }),
            login: jest.fn().mockImplementation(async (req, res) => {
                try {
                    const result = await mockUserServiceInstance.authenticateUser(req.body.login, req.body.password);
                    res.json(result);
                }
                catch (error) {
                    res.status(401).json({ error: error.message });
                }
            }),
        };
        mockRequest = {};
        mockResponse = {
            status: jest.fn().mockReturnThis(),
            json: jest.fn().mockReturnThis()
        };
        jest.clearAllMocks();
    });
    describe('createUser', () => {
        it('should create user successfully', async () => {
            const userData = {
                name: 'João Silva',
                mail: 'joao@test.com',
                login: 'joao123',
                password: 'password123',
                role: 'customer'
            };
            const createdUser = {
                id: 1,
                name: userData.name,
                mail: userData.mail,
                login: userData.login,
                role: userData.role
            };
            mockRequest.body = userData;
            mockUserServiceInstance.createUser.mockResolvedValue(createdUser);
            await userController.createUser(mockRequest, mockResponse);
            expect(mockUserServiceInstance.createUser).toHaveBeenCalledWith(userData);
            expect(mockResponse.status).toHaveBeenCalledWith(201);
            expect(mockResponse.json).toHaveBeenCalledWith({
                id: createdUser.id,
                name: createdUser.name,
                mail: createdUser.mail,
                login: createdUser.login,
                role: createdUser.role
            });
        });
        it('should handle creation error', async () => {
            const userData = {
                name: 'João Silva',
                mail: 'joao@test.com',
                login: 'joao123',
                password: 'password123'
            };
            const error = new Error('Login ou email já existem');
            mockRequest.body = userData;
            mockUserServiceInstance.createUser.mockRejectedValue(error);
            await userController.createUser(mockRequest, mockResponse);
            expect(mockResponse.status).toHaveBeenCalledWith(400);
            expect(mockResponse.json).toHaveBeenCalledWith({ error: error.message });
        });
    });
    describe('getAllUsers', () => {
        it('should return all users', async () => {
            const users = [
                { id: 1, name: 'João', mail: 'joao@test.com', role: 'customer' },
                { id: 2, name: 'Maria', mail: 'maria@test.com', role: 'admin' }
            ];
            mockUserServiceInstance.getAllUsers.mockResolvedValue(users);
            await userController.getAllUsers(mockRequest, mockResponse);
            expect(mockUserServiceInstance.getAllUsers).toHaveBeenCalled();
            expect(mockResponse.json).toHaveBeenCalledWith(users);
        });
        it('should handle service error', async () => {
            const error = new Error('Database connection failed');
            mockUserServiceInstance.getAllUsers.mockRejectedValue(error);
            await userController.getAllUsers(mockRequest, mockResponse);
            expect(mockResponse.status).toHaveBeenCalledWith(500);
            expect(mockResponse.json).toHaveBeenCalledWith({ error: error.message });
        });
    });
    describe('getUserById', () => {
        it('should return user by id', async () => {
            const user = { id: 1, name: 'João', mail: 'joao@test.com', role: 'customer' };
            mockRequest.params = { id: '1' };
            mockUserServiceInstance.getUserById.mockResolvedValue(user);
            await userController.getUserById(mockRequest, mockResponse);
            expect(mockUserServiceInstance.getUserById).toHaveBeenCalledWith(1);
            expect(mockResponse.json).toHaveBeenCalledWith(user);
        });
        it('should handle user not found', async () => {
            const error = new Error('Usuário não encontrado');
            mockRequest.params = { id: '999' };
            mockUserServiceInstance.getUserById.mockRejectedValue(error);
            await userController.getUserById(mockRequest, mockResponse);
            expect(mockResponse.status).toHaveBeenCalledWith(404);
            expect(mockResponse.json).toHaveBeenCalledWith({ error: error.message });
        });
    });
    describe('updateUser', () => {
        it('should update user successfully', async () => {
            const updateData = { name: 'João Santos' };
            const updatedUser = { id: 1, name: 'João Santos', mail: 'joao@test.com', role: 'customer' };
            mockRequest.params = { id: '1' };
            mockRequest.body = updateData;
            mockUserServiceInstance.updateUser.mockResolvedValue(updatedUser);
            await userController.updateUser(mockRequest, mockResponse);
            expect(mockUserServiceInstance.updateUser).toHaveBeenCalledWith(1, updateData);
            expect(mockResponse.json).toHaveBeenCalledWith({
                id: updatedUser.id,
                name: updatedUser.name,
                mail: updatedUser.mail,
                role: updatedUser.role
            });
        });
        it('should handle update error', async () => {
            const error = new Error('Usuário não encontrado');
            mockRequest.params = { id: '999' };
            mockRequest.body = { name: 'Test' };
            mockUserServiceInstance.updateUser.mockRejectedValue(error);
            await userController.updateUser(mockRequest, mockResponse);
            expect(mockResponse.status).toHaveBeenCalledWith(404);
            expect(mockResponse.json).toHaveBeenCalledWith({ error: error.message });
        });
    });
    describe('deleteUser', () => {
        it('should delete user successfully', async () => {
            mockRequest.params = { id: '1' };
            mockUserServiceInstance.deleteUser.mockResolvedValue({ message: 'Usuário deletado com sucesso' });
            await userController.deleteUser(mockRequest, mockResponse);
            expect(mockUserServiceInstance.deleteUser).toHaveBeenCalledWith(1);
            expect(mockResponse.json).toHaveBeenCalledWith({ message: 'Usuário deletado com sucesso' });
        });
        it('should handle delete error', async () => {
            const error = new Error('Usuário não encontrado');
            mockRequest.params = { id: '999' };
            mockUserServiceInstance.deleteUser.mockRejectedValue(error);
            await userController.deleteUser(mockRequest, mockResponse);
            expect(mockResponse.status).toHaveBeenCalledWith(404);
            expect(mockResponse.json).toHaveBeenCalledWith({ error: error.message });
        });
    });
    describe('login', () => {
        it('should login successfully', async () => {
            const loginData = {
                login: 'joao123',
                password: 'password123'
            };
            const loginResult = {
                user: {
                    id: 1,
                    name: 'João Silva',
                    mail: 'joao@test.com',
                    login: 'joao123',
                    role: 'customer'
                },
                token: 'jwt_token_123'
            };
            mockRequest.body = loginData;
            mockUserServiceInstance.authenticateUser.mockResolvedValue(loginResult);
            await userController.login(mockRequest, mockResponse);
            expect(mockUserServiceInstance.authenticateUser).toHaveBeenCalledWith(loginData.login, loginData.password);
            expect(mockResponse.json).toHaveBeenCalledWith(loginResult);
        });
        it('should handle login error', async () => {
            const loginData = {
                login: 'invalid',
                password: 'wrong_password'
            };
            const error = new Error('Credenciais inválidas');
            mockRequest.body = loginData;
            mockUserServiceInstance.authenticateUser.mockRejectedValue(error);
            await userController.login(mockRequest, mockResponse);
            expect(mockResponse.status).toHaveBeenCalledWith(401);
            expect(mockResponse.json).toHaveBeenCalledWith({ error: error.message });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRTpcXEN1cnNvIEpTXFxEZXBsb3lcXENvbW1lcmNlXFxiYWNrZW5kXFx0ZXN0c1xcY29udHJvbGxlcnNcXHVzZXJDb250cm9sbGVyLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7QUFJQSxzQkFBc0I7QUFDdEIsSUFBSSxDQUFDLElBQUksQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDO0FBSDVDLGdFQUE2RDtBQUk3RCxNQUFNLGVBQWUsR0FBRyx5QkFBbUQsQ0FBQztBQUU1RSxRQUFRLENBQUMsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFO0lBQzlCLElBQUksY0FBOEIsQ0FBQztJQUNuQyxJQUFJLFdBQTZCLENBQUM7SUFDbEMsSUFBSSxZQUErQixDQUFDO0lBQ3BDLElBQUksdUJBQWlELENBQUM7SUFFdEQsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLHlDQUF5QztRQUN6Qyx1QkFBdUIsR0FBRztZQUN4QixVQUFVLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNyQixXQUFXLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUN0QixXQUFXLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUN0QixVQUFVLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNyQixVQUFVLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNyQixnQkFBZ0IsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQzNCLGNBQWMsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1NBQ0UsQ0FBQztRQUU5QiwyREFBMkQ7UUFDM0QsY0FBYyxHQUFHO1lBQ2YsVUFBVSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxLQUFLLEVBQUUsR0FBUSxFQUFFLEdBQVEsRUFBRSxFQUFFO2dCQUNwRSxJQUFJLENBQUM7b0JBQ0gsTUFBTSxJQUFJLEdBQUcsTUFBTSx1QkFBdUIsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO29CQUNoRSxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxD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b0IsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUM5RCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywyQkFBMkIsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN6QyxNQUFNLFNBQVMsR0FBRztnQkFDaEIsS0FBSyxFQUFFLFNBQVM7Z0JBQ2hCLFFBQVEsRUFBRSxnQkFBZ0I7YUFDM0IsQ0FBQztZQUVGLE1BQU0sS0FBSyxHQUFHLElBQUksS0FBSyxDQUFDLHVCQUF1QixDQUFDLENBQUM7WUFDakQsV0FBVyxDQUFDLElBQUksR0FBRyxTQUFTLENBQUM7WUFDN0IsdUJBQXVCLENBQUMsZ0JBQWdCLENBQUMsaUJBQWlCLENBQUMsS0FBSyxDQUFDLENBQUM7WUFFbEUsTUFBTSxjQUFjLENBQUMsS0FBSyxDQUFDLFdBQXNCLEVBQUUsWUFBd0IsQ0FBQyxDQUFDO1lBRTdFLE1BQU0sQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUMsb0JBQW9CLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDdEQsTUFBTSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxFQUFFLEtBQUssRUFBRSxLQUFLLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztRQUMzRSxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiRTpcXEN1cnNvIEpTXFxEZXBsb3lcXENvbW1lcmNlXFxiYWNrZW5kXFx0ZXN0c1xcY29udHJvbGxlcnNcXHVzZXJDb250cm9sbGVyLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUmVxdWVzdCwgUmVzcG9uc2UgfSBmcm9tICdleHByZXNzJztcclxuaW1wb3J0IHsgVXNlckNvbnRyb2xsZXIgfSBmcm9tICcuLi8uLi9zcmMvY29udHJvbGxlcnMvdXNlckNvbnRyb2xsZXInO1xyXG5pbXBvcnQgeyBVc2VyU2VydmljZSB9IGZyb20gJy4uLy4uL3NyYy9zZXJ2aWNlcy91c2VyU2VydmljZSc7XHJcblxyXG4vLyBNb2NrIGRvIFVzZXJTZXJ2aWNlXHJcbmplc3QubW9jaygnLi4vLi4vc3JjL3NlcnZpY2VzL3VzZXJTZXJ2aWNlJyk7XHJcbmNvbnN0IG1vY2tVc2VyU2VydmljZSA9IFVzZXJTZXJ2aWNlIGFzIGplc3QuTW9ja2VkQ2xhc3M8dHlwZW9mIFVzZXJTZXJ2aWNlPjtcclxuXHJcbmRlc2NyaWJlKCdVc2VyQ29udHJvbGxlcicsICgpID0+IHtcclxuICBsZXQgdXNlckNvbnRyb2xsZXI6IFVzZXJDb250cm9sbGVyO1xyXG4gIGxldCBtb2NrUmVxdWVzdDogUGFydGlhbDxSZXF1ZXN0PjtcclxuICBsZXQgbW9ja1Jlc3BvbnNlOiBQYXJ0aWFsPFJlc3BvbnNlPjtcclxuICBsZXQgbW9ja1VzZXJTZXJ2aWNlSW5zdGFuY2U6IGplc3QuTW9ja2VkPFVzZXJTZXJ2aWNlPjtcclxuXHJcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAvLyBDcmlhciBpbnN0w6JuY2lhIG1vY2thZGEgZG8gVXNlclNlcnZpY2VcclxuICAgIG1vY2tVc2VyU2VydmljZUluc3RhbmNlID0ge1xyXG4gICAgICBjcmVhdGVVc2VyOiBqZXN0LmZuKCksXHJcbiAgICAgIGdldEFsbFVzZXJzOiBqZXN0LmZuKCksXHJcbiAgICAgIGdldFVzZXJCeUlkOiBqZXN0LmZuKCksXHJcbiAgICAgIHVwZGF0ZVVzZXI6IGplc3QuZm4oKSxcclxuICAgICAgZGVsZXRlVXNlcjogamVzdC5mbigpLFxyXG4gICAgICBhdXRoZW50aWNhdGVVc2VyOiBqZXN0LmZuKCksXHJcbiAgICAgIGNyZWF0ZUN1c3RvbWVyOiBqZXN0LmZuKCksXHJcbiAgICB9IGFzIGplc3QuTW9ja2VkPFVzZXJTZXJ2aWNlPjtcclxuXHJcbiAgICAvLyBNb2NrIGRvIFVzZXJDb250cm9sbGVyIHBhcmEgdXNhciBub3NzYSBpbnN0w6JuY2lhIG1vY2thZGFcclxuICAgIHVzZXJDb250cm9sbGVyID0ge1xyXG4gICAgICBjcmVhdGVVc2VyOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKGFzeW5jIChyZXE6IGFueSwgcmVzOiBhbnkpID0+IHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IG1vY2tVc2VyU2VydmljZUluc3RhbmNlLmNyZWF0ZVVzZXIocmVxLmJvZHkpO1xyXG4gICAgICAgICAgcmVzLnN0YXR1cygyMDEpLmpzb24oe1xyXG4gICAgICAgICAgICBpZDogdXNlci5pZCxcclxuICAgICAgICAgICAgbmFtZTogdXNlci5uYW1lLFxyXG4gICAgICAgICAgICBtYWlsOiB1c2VyLm1haWwsXHJcbiAgICAgICAgICAgIGxvZ2luOiB1c2VyLmxvZ2luLFxyXG4gICAgICAgICAgICByb2xlOiB1c2VyLnJvbGVcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcclxuICAgICAgICAgIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KSxcclxuICAgICAgZ2V0QWxsVXNlcnM6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oYXN5bmMgKHJlcTogYW55LCByZXM6IGFueSkgPT4ge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICBjb25zdCB1c2VycyA9IGF3YWl0IG1vY2tVc2VyU2VydmljZUluc3RhbmNlLmdldEFsbFVzZXJzKCk7XHJcbiAgICAgICAgICByZXMuanNvbih1c2Vycyk7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnJvcjogZXJyb3IubWVzc2FnZSB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pLFxyXG4gICAgICBnZXRVc2VyQnlJZDogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbihhc3luYyAocmVxOiBhbnksIHJlczogYW55KSA9PiB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBtb2NrVXNlclNlcnZpY2VJbnN0YW5jZS5nZXRVc2VyQnlJZChwYXJzZUludChyZXEucGFyYW1zLmlkKSk7XHJcbiAgICAgICAgICByZXMuanNvbih1c2VyKTtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XHJcbiAgICAgICAgICByZXMuc3RhdHVzKDQwNCkuanNvbih7IGVycm9yOiBlcnJvci5tZXNzYWdlIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfSksXHJcbiAgICAgIHVwZGF0ZVVzZXI6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oYXN5bmMgKHJlcTogYW55LCByZXM6IGFueSkgPT4ge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgbW9ja1VzZXJTZXJ2aWNlSW5zdGFuY2UudXBkYXRlVXNlcihwYXJzZUludChyZXEucGFyYW1zLmlkKSwgcmVxLmJvZHkpO1xyXG4gICAgICAgICAgcmVzLmpzb24oe1xyXG4gICAgICAgICAgICBpZDogdXNlci5pZCxcclxuICAgICAgICAgICAgbmFtZTogdXNlci5uYW1lLFxyXG4gICAgICAgICAgICBtYWlsOiB1c2VyLm1haWwsXHJcbiAgICAgICAgICAgIHJvbGU6IHVzZXIucm9sZVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xyXG4gICAgICAgICAgcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBlcnJvcjogZXJyb3IubWVzc2FnZSB9KTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pLFxyXG4gICAgICBkZWxldGVVc2VyOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKGFzeW5jIChyZXE6IGFueSwgcmVzOiBhbnkpID0+IHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgbW9ja1VzZXJTZXJ2aWNlSW5zdGFuY2UuZGVsZXRlVXNlcihwYXJzZUludChyZXEucGFyYW1zLmlkKSk7XHJcbiAgICAgICAgICByZXMuanNvbihyZXN1bHQpO1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcclxuICAgICAgICAgIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KSxcclxuICAgICAgbG9naW46IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oYXN5bmMgKHJlcTogYW55LCByZXM6IGFueSkgPT4ge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBtb2NrVXNlclNlcnZpY2VJbnN0YW5jZS5hdXRoZW50aWNhdGVVc2VyKHJlcS5ib2R5LmxvZ2luLCByZXEuYm9keS5wYXNzd29yZCk7XHJcbiAgICAgICAgICByZXMuanNvbihyZXN1bHQpO1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcclxuICAgICAgICAgIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KSxcclxuICAgIH0gYXMgYW55O1xyXG4gICAgXHJcbiAgICBtb2NrUmVxdWVzdCA9IHt9O1xyXG4gICAgbW9ja1Jlc3BvbnNlID0ge1xyXG4gICAgICBzdGF0dXM6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxyXG4gICAgICBqc29uOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKVxyXG4gICAgfTtcclxuXHJcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2NyZWF0ZVVzZXInLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSB1c2VyIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgdXNlckRhdGEgPSB7XHJcbiAgICAgICAgbmFtZTogJ0pvw6NvIFNpbHZhJyxcclxuICAgICAgICBtYWlsOiAnam9hb0B0ZXN0LmNvbScsXHJcbiAgICAgICAgbG9naW46ICdqb2FvMTIzJyxcclxuICAgICAgICBwYXNzd29yZDogJ3Bhc3N3b3JkMTIzJyxcclxuICAgICAgICByb2xlOiAnY3VzdG9tZXInXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBjb25zdCBjcmVhdGVkVXNlciA9IHtcclxuICAgICAgICBpZDogMSxcclxuICAgICAgICBuYW1lOiB1c2VyRGF0YS5uYW1lLFxyXG4gICAgICAgIG1haWw6IHVzZXJEYXRhLm1haWwsXHJcbiAgICAgICAgbG9naW46IHVzZXJEYXRhLmxvZ2luLFxyXG4gICAgICAgIHJvbGU6IHVzZXJEYXRhLnJvbGVcclxuICAgICAgfTtcclxuXHJcbiAgICAgIG1vY2tSZXF1ZXN0LmJvZHkgPSB1c2VyRGF0YTtcclxuICAgICAgbW9ja1VzZXJTZXJ2aWNlSW5zdGFuY2UuY3JlYXRlVXNlci5tb2NrUmVzb2x2ZWRWYWx1ZShjcmVhdGVkVXNlciBhcyBhbnkpO1xyXG5cclxuICAgICAgYXdhaXQgdXNlckNvbnRyb2xsZXIuY3JlYXRlVXNlcihtb2NrUmVxdWVzdCBhcyBSZXF1ZXN0LCBtb2NrUmVzcG9uc2UgYXMgUmVzcG9uc2UpO1xyXG5cclxuICAgICAgZXhwZWN0KG1vY2tVc2VyU2VydmljZUluc3RhbmNlLmNyZWF0ZVVzZXIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHVzZXJEYXRhKTtcclxuICAgICAgZXhwZWN0KG1vY2tSZXNwb25zZS5zdGF0dXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDIwMSk7XHJcbiAgICAgIGV4cGVjdChtb2NrUmVzcG9uc2UuanNvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xyXG4gICAgICAgIGlkOiBjcmVhdGVkVXNlci5pZCxcclxuICAgICAgICBuYW1lOiBjcmVhdGVkVXNlci5uYW1lLFxyXG4gICAgICAgIG1haWw6IGNyZWF0ZWRVc2VyLm1haWwsXHJcbiAgICAgICAgbG9naW46IGNyZWF0ZWRVc2VyLmxvZ2luLFxyXG4gICAgICAgIHJvbGU6IGNyZWF0ZWRVc2VyLnJvbGVcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjcmVhdGlvbiBlcnJvcicsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgdXNlckRhdGEgPSB7XHJcbiAgICAgICAgbmFtZTogJ0pvw6NvIFNpbHZhJyxcclxuICAgICAgICBtYWlsOiAnam9hb0B0ZXN0LmNvbScsXHJcbiAgICAgICAgbG9naW46ICdqb2FvMTIzJyxcclxuICAgICAgICBwYXNzd29yZDogJ3Bhc3N3b3JkMTIzJ1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoJ0xvZ2luIG91IGVtYWlsIGrDoSBleGlzdGVtJyk7XHJcblxyXG4gICAgICBtb2NrUmVxdWVzdC5ib2R5ID0gdXNlckRhdGE7XHJcbiAgICAgIG1vY2tVc2VyU2VydmljZUluc3RhbmNlLmNyZWF0ZVVzZXIubW9ja1JlamVjdGVkVmFsdWUoZXJyb3IpO1xyXG5cclxuICAgICAgYXdhaXQgdXNlckNvbnRyb2xsZXIuY3JlYXRlVXNlcihtb2NrUmVxdWVzdCBhcyBSZXF1ZXN0LCBtb2NrUmVzcG9uc2UgYXMgUmVzcG9uc2UpO1xyXG5cclxuICAgICAgZXhwZWN0KG1vY2tSZXNwb25zZS5zdGF0dXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDQwMCk7XHJcbiAgICAgIGV4cGVjdChtb2NrUmVzcG9uc2UuanNvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoeyBlcnJvcjogZXJyb3IubWVzc2FnZSB9KTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZ2V0QWxsVXNlcnMnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHJldHVybiBhbGwgdXNlcnMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHVzZXJzID0gW1xyXG4gICAgICAgIHsgaWQ6IDEsIG5hbWU6ICdKb8OjbycsIG1haWw6ICdqb2FvQHRlc3QuY29tJywgcm9sZTogJ2N1c3RvbWVyJyB9LFxyXG4gICAgICAgIHsgaWQ6IDIsIG5hbWU6ICdNYXJpYScsIG1haWw6ICdtYXJpYUB0ZXN0LmNvbScsIHJvbGU6ICdhZG1pbicgfVxyXG4gICAgICBdO1xyXG5cclxuICAgICAgbW9ja1VzZXJTZXJ2aWNlSW5zdGFuY2UuZ2V0QWxsVXNlcnMubW9ja1Jlc29sdmVkVmFsdWUodXNlcnMgYXMgYW55KTtcclxuXHJcbiAgICAgIGF3YWl0IHVzZXJDb250cm9sbGVyLmdldEFsbFVzZXJzKG1vY2tSZXF1ZXN0IGFzIFJlcXVlc3QsIG1vY2tSZXNwb25zZSBhcyBSZXNwb25zZSk7XHJcblxyXG4gICAgICBleHBlY3QobW9ja1VzZXJTZXJ2aWNlSW5zdGFuY2UuZ2V0QWxsVXNlcnMpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgICAgZXhwZWN0KG1vY2tSZXNwb25zZS5qc29uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh1c2Vycyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzZXJ2aWNlIGVycm9yJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcignRGF0YWJhc2UgY29ubmVjdGlvbiBmYWlsZWQnKTtcclxuICAgICAgbW9ja1VzZXJTZXJ2aWNlSW5zdGFuY2UuZ2V0QWxsVXNlcnMubW9ja1JlamVjdGVkVmFsdWUoZXJyb3IpO1xyXG5cclxuICAgICAgYXdhaXQgdXNlckNvbnRyb2xsZXIuZ2V0QWxsVXNlcnMobW9ja1JlcXVlc3QgYXMgUmVxdWVzdCwgbW9ja1Jlc3BvbnNlIGFzIFJlc3BvbnNlKTtcclxuXHJcbiAgICAgIGV4cGVjdChtb2NrUmVzcG9uc2Uuc3RhdHVzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCg1MDApO1xyXG4gICAgICBleHBlY3QobW9ja1Jlc3BvbnNlLmpzb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2dldFVzZXJCeUlkJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gdXNlciBieSBpZCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgdXNlciA9IHsgaWQ6IDEsIG5hbWU6ICdKb8OjbycsIG1haWw6ICdqb2FvQHRlc3QuY29tJywgcm9sZTogJ2N1c3RvbWVyJyB9O1xyXG4gICAgICBtb2NrUmVxdWVzdC5wYXJhbXMgPSB7IGlkOiAnMScgfTtcclxuICAgICAgbW9ja1VzZXJTZXJ2aWNlSW5zdGFuY2UuZ2V0VXNlckJ5SWQubW9ja1Jlc29sdmVkVmFsdWUodXNlciBhcyBhbnkpO1xyXG5cclxuICAgICAgYXdhaXQgdXNlckNvbnRyb2xsZXIuZ2V0VXNlckJ5SWQobW9ja1JlcXVlc3QgYXMgUmVxdWVzdCwgbW9ja1Jlc3BvbnNlIGFzIFJlc3BvbnNlKTtcclxuXHJcbiAgICAgIGV4cGVjdChtb2NrVXNlclNlcnZpY2VJbnN0YW5jZS5nZXRVc2VyQnlJZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoMSk7XHJcbiAgICAgIGV4cGVjdChtb2NrUmVzcG9uc2UuanNvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgodXNlcik7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSB1c2VyIG5vdCBmb3VuZCcsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoJ1VzdcOhcmlvIG7Do28gZW5jb250cmFkbycpO1xyXG4gICAgICBtb2NrUmVxdWVzdC5wYXJhbXMgPSB7IGlkOiAnOTk5JyB9O1xyXG4gICAgICBtb2NrVXNlclNlcnZpY2VJbnN0YW5jZS5nZXRVc2VyQnlJZC5tb2NrUmVqZWN0ZWRWYWx1ZShlcnJvcik7XHJcblxyXG4gICAgICBhd2FpdCB1c2VyQ29udHJvbGxlci5nZXRVc2VyQnlJZChtb2NrUmVxdWVzdCBhcyBSZXF1ZXN0LCBtb2NrUmVzcG9uc2UgYXMgUmVzcG9uc2UpO1xyXG5cclxuICAgICAgZXhwZWN0KG1vY2tSZXNwb25zZS5zdGF0dXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDQwNCk7XHJcbiAgICAgIGV4cGVjdChtb2NrUmVzcG9uc2UuanNvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoeyBlcnJvcjogZXJyb3IubWVzc2FnZSB9KTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgndXBkYXRlVXNlcicsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgdXBkYXRlIHVzZXIgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCB1cGRhdGVEYXRhID0geyBuYW1lOiAnSm/Do28gU2FudG9zJyB9O1xyXG4gICAgICBjb25zdCB1cGRhdGVkVXNlciA9IHsgaWQ6IDEsIG5hbWU6ICdKb8OjbyBTYW50b3MnLCBtYWlsOiAnam9hb0B0ZXN0LmNvbScsIHJvbGU6ICdjdXN0b21lcicgfTtcclxuXHJcbiAgICAgIG1vY2tSZXF1ZXN0LnBhcmFtcyA9IHsgaWQ6ICcxJyB9O1xyXG4gICAgICBtb2NrUmVxdWVzdC5ib2R5ID0gdXBkYXRlRGF0YTtcclxuICAgICAgbW9ja1VzZXJTZXJ2aWNlSW5zdGFuY2UudXBkYXRlVXNlci5tb2NrUmVzb2x2ZWRWYWx1ZSh1cGRhdGVkVXNlciBhcyBhbnkpO1xyXG5cclxuICAgICAgYXdhaXQgdXNlckNvbnRyb2xsZXIudXBkYXRlVXNlcihtb2NrUmVxdWVzdCBhcyBSZXF1ZXN0LCBtb2NrUmVzcG9uc2UgYXMgUmVzcG9uc2UpO1xyXG5cclxuICAgICAgZXhwZWN0KG1vY2tVc2VyU2VydmljZUluc3RhbmNlLnVwZGF0ZVVzZXIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDEsIHVwZGF0ZURhdGEpO1xyXG4gICAgICBleHBlY3QobW9ja1Jlc3BvbnNlLmpzb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcclxuICAgICAgICBpZDogdXBkYXRlZFVzZXIuaWQsXHJcbiAgICAgICAgbmFtZTogdXBkYXRlZFVzZXIubmFtZSxcclxuICAgICAgICBtYWlsOiB1cGRhdGVkVXNlci5tYWlsLFxyXG4gICAgICAgIHJvbGU6IHVwZGF0ZWRVc2VyLnJvbGVcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSB1cGRhdGUgZXJyb3InLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKCdVc3XDoXJpbyBuw6NvIGVuY29udHJhZG8nKTtcclxuICAgICAgbW9ja1JlcXVlc3QucGFyYW1zID0geyBpZDogJzk5OScgfTtcclxuICAgICAgbW9ja1JlcXVlc3QuYm9keSA9IHsgbmFtZTogJ1Rlc3QnIH07XHJcbiAgICAgIG1vY2tVc2VyU2VydmljZUluc3RhbmNlLnVwZGF0ZVVzZXIubW9ja1JlamVjdGVkVmFsdWUoZXJyb3IpO1xyXG5cclxuICAgICAgYXdhaXQgdXNlckNvbnRyb2xsZXIudXBkYXRlVXNlcihtb2NrUmVxdWVzdCBhcyBSZXF1ZXN0LCBtb2NrUmVzcG9uc2UgYXMgUmVzcG9uc2UpO1xyXG5cclxuICAgICAgZXhwZWN0KG1vY2tSZXNwb25zZS5zdGF0dXMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDQwNCk7XHJcbiAgICAgIGV4cGVjdChtb2NrUmVzcG9uc2UuanNvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoeyBlcnJvcjogZXJyb3IubWVzc2FnZSB9KTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnZGVsZXRlVXNlcicsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgZGVsZXRlIHVzZXIgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBtb2NrUmVxdWVzdC5wYXJhbXMgPSB7IGlkOiAnMScgfTtcclxuICAgICAgbW9ja1VzZXJTZXJ2aWNlSW5zdGFuY2UuZGVsZXRlVXNlci5tb2NrUmVzb2x2ZWRWYWx1ZSh7IG1lc3NhZ2U6ICdVc3XDoXJpbyBkZWxldGFkbyBjb20gc3VjZXNzbycgfSBhcyBhbnkpO1xyXG5cclxuICAgICAgYXdhaXQgdXNlckNvbnRyb2xsZXIuZGVsZXRlVXNlcihtb2NrUmVxdWVzdCBhcyBSZXF1ZXN0LCBtb2NrUmVzcG9uc2UgYXMgUmVzcG9uc2UpO1xyXG5cclxuICAgICAgZXhwZWN0KG1vY2tVc2VyU2VydmljZUluc3RhbmNlLmRlbGV0ZVVzZXIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDEpO1xyXG4gICAgICBleHBlY3QobW9ja1Jlc3BvbnNlLmpzb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHsgbWVzc2FnZTogJ1VzdcOhcmlvIGRlbGV0YWRvIGNvbSBzdWNlc3NvJyB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGRlbGV0ZSBlcnJvcicsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoJ1VzdcOhcmlvIG7Do28gZW5jb250cmFkbycpO1xyXG4gICAgICBtb2NrUmVxdWVzdC5wYXJhbXMgPSB7IGlkOiAnOTk5JyB9O1xyXG4gICAgICBtb2NrVXNlclNlcnZpY2VJbnN0YW5jZS5kZWxldGVVc2VyLm1vY2tSZWplY3RlZFZhbHVlKGVycm9yKTtcclxuXHJcbiAgICAgIGF3YWl0IHVzZXJDb250cm9sbGVyLmRlbGV0ZVVzZXIobW9ja1JlcXVlc3QgYXMgUmVxdWVzdCwgbW9ja1Jlc3BvbnNlIGFzIFJlc3BvbnNlKTtcclxuXHJcbiAgICAgIGV4cGVjdChtb2NrUmVzcG9uc2Uuc3RhdHVzKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCg0MDQpO1xyXG4gICAgICBleHBlY3QobW9ja1Jlc3BvbnNlLmpzb24pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ2xvZ2luJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBsb2dpbiBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGxvZ2luRGF0YSA9IHtcclxuICAgICAgICBsb2dpbjogJ2pvYW8xMjMnLFxyXG4gICAgICAgIHBhc3N3b3JkOiAncGFzc3dvcmQxMjMnXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBjb25zdCBsb2dpblJlc3VsdCA9IHtcclxuICAgICAgICB1c2VyOiB7XHJcbiAgICAgICAgICBpZDogMSxcclxuICAgICAgICAgIG5hbWU6ICdKb8OjbyBTaWx2YScsXHJcbiAgICAgICAgICBtYWlsOiAnam9hb0B0ZXN0LmNvbScsXHJcbiAgICAgICAgICBsb2dpbjogJ2pvYW8xMjMnLFxyXG4gICAgICAgICAgcm9sZTogJ2N1c3RvbWVyJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdG9rZW46ICdqd3RfdG9rZW5fMTIzJ1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgbW9ja1JlcXVlc3QuYm9keSA9IGxvZ2luRGF0YTtcclxuICAgICAgbW9ja1VzZXJTZXJ2aWNlSW5zdGFuY2UuYXV0aGVudGljYXRlVXNlci5tb2NrUmVzb2x2ZWRWYWx1ZShsb2dpblJlc3VsdCBhcyBhbnkpO1xyXG5cclxuICAgICAgYXdhaXQgdXNlckNvbnRyb2xsZXIubG9naW4obW9ja1JlcXVlc3QgYXMgUmVxdWVzdCwgbW9ja1Jlc3BvbnNlIGFzIFJlc3BvbnNlKTtcclxuXHJcbiAgICAgIGV4cGVjdChtb2NrVXNlclNlcnZpY2VJbnN0YW5jZS5hdXRoZW50aWNhdGVVc2VyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChsb2dpbkRhdGEubG9naW4sIGxvZ2luRGF0YS5wYXNzd29yZCk7XHJcbiAgICAgIGV4cGVjdChtb2NrUmVzcG9uc2UuanNvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgobG9naW5SZXN1bHQpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbG9naW4gZXJyb3InLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGxvZ2luRGF0YSA9IHtcclxuICAgICAgICBsb2dpbjogJ2ludmFsaWQnLFxyXG4gICAgICAgIHBhc3N3b3JkOiAnd3JvbmdfcGFzc3dvcmQnXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcignQ3JlZGVuY2lhaXMgaW52w6FsaWRhcycpO1xyXG4gICAgICBtb2NrUmVxdWVzdC5ib2R5ID0gbG9naW5EYXRhO1xyXG4gICAgICBtb2NrVXNlclNlcnZpY2VJbnN0YW5jZS5hdXRoZW50aWNhdGVVc2VyLm1vY2tSZWplY3RlZFZhbHVlKGVycm9yKTtcclxuXHJcbiAgICAgIGF3YWl0IHVzZXJDb250cm9sbGVyLmxvZ2luKG1vY2tSZXF1ZXN0IGFzIFJlcXVlc3QsIG1vY2tSZXNwb25zZSBhcyBSZXNwb25zZSk7XHJcblxyXG4gICAgICBleHBlY3QobW9ja1Jlc3BvbnNlLnN0YXR1cykudG9IYXZlQmVlbkNhbGxlZFdpdGgoNDAxKTtcclxuICAgICAgZXhwZWN0KG1vY2tSZXNwb25zZS5qc29uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7IGVycm9yOiBlcnJvci5tZXNzYWdlIH0pO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==