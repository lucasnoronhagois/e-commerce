04eb1cfd48b2c99d9a965b98120fa134
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// Mock do Sequelize
const mockSequelize = {
    define: jest.fn(),
    sync: jest.fn(),
    authenticate: jest.fn(),
    close: jest.fn()
};
// Mock do Model
const mockModel = {
    init: jest.fn(),
    create: jest.fn(),
    findAll: jest.fn(),
    findByPk: jest.fn(),
    findOne: jest.fn(),
    bulkCreate: jest.fn(),
    destroy: jest.fn(),
    associate: jest.fn()
};
describe('User Model', () => {
    beforeEach(() => {
        jest.clearAllMocks();
    });
    describe('User Creation', () => {
        it('should create a user with valid data', async () => {
            const userData = {
                name: 'João Silva',
                mail: 'joao@test.com',
                login: 'joao123',
                password: 'password123',
                role: 'customer'
            };
            const createdUser = {
                id: 1,
                ...userData,
                is_deleted: false,
                created_at: new Date(),
                updated_at: new Date()
            };
            mockModel.create.mockResolvedValue(createdUser);
            const result = await mockModel.create(userData);
            expect(result).toBeDefined();
            expect(result.id).toBe(1);
            expect(result.name).toBe(userData.name);
            expect(result.mail).toBe(userData.mail);
            expect(result.login).toBe(userData.login);
            expect(result.role).toBe(userData.role);
            expect(result.is_deleted).toBe(false);
        });
        it('should set default role as customer', async () => {
            const userData = {
                name: 'Maria Santos',
                mail: 'maria@test.com',
                login: 'maria123',
                password: 'password123'
            };
            const createdUser = {
                id: 1,
                ...userData,
                role: 'customer'
            };
            mockModel.create.mockResolvedValue(createdUser);
            const result = await mockModel.create(userData);
            expect(result.role).toBe('customer');
        });
        it('should handle creation errors', async () => {
            const userData = {
                name: 'João Silva',
                mail: 'joao@test.com',
                login: 'joao123',
                password: 'password123'
            };
            const error = new Error('Validation error');
            mockModel.create.mockRejectedValue(error);
            await expect(mockModel.create(userData)).rejects.toThrow('Validation error');
        });
    });
    describe('User Queries', () => {
        it('should find user by id', async () => {
            const user = { id: 1, name: 'João Silva', mail: 'joao@test.com', role: 'customer' };
            mockModel.findByPk.mockResolvedValue(user);
            const result = await mockModel.findByPk(1);
            expect(result).toBeDefined();
            expect(result.name).toBe('João Silva');
        });
        it('should find user by email', async () => {
            const user = { id: 1, name: 'Maria Santos', mail: 'maria@test.com', role: 'admin' };
            mockModel.findOne.mockResolvedValue(user);
            const result = await mockModel.findOne({ where: { mail: 'maria@test.com' } });
            expect(result).toBeDefined();
            expect(result.name).toBe('Maria Santos');
            expect(result.role).toBe('admin');
        });
        it('should find all users', async () => {
            const users = [
                { id: 1, name: 'João', mail: 'joao@test.com', role: 'customer' },
                { id: 2, name: 'Maria', mail: 'maria@test.com', role: 'admin' }
            ];
            mockModel.findAll.mockResolvedValue(users);
            const result = await mockModel.findAll();
            expect(result).toHaveLength(2);
        });
        it('should find only active users', async () => {
            const activeUsers = [
                { id: 1, name: 'João', is_deleted: false },
                { id: 2, name: 'Maria', is_deleted: false }
            ];
            mockModel.findAll.mockResolvedValue(activeUsers);
            const result = await mockModel.findAll({ where: { is_deleted: false } });
            expect(result).toHaveLength(2);
        });
        it('should find users by role', async () => {
            const customers = [
                { id: 1, name: 'João', role: 'customer' },
                { id: 2, name: 'Pedro', role: 'customer' }
            ];
            mockModel.findAll.mockResolvedValue(customers);
            const result = await mockModel.findAll({ where: { role: 'customer' } });
            expect(result).toHaveLength(2);
        });
    });
    describe('User Updates', () => {
        it('should update user data', async () => {
            const updateData = { name: 'João Santos' };
            const updatedUser = { id: 1, name: 'João Santos', mail: 'joao@test.com' };
            const mockUser = {
                update: jest.fn().mockResolvedValue(updatedUser)
            };
            mockModel.findByPk.mockResolvedValue(mockUser);
            const user = await mockModel.findByPk(1);
            const result = await user.update(updateData);
            expect(result.name).toBe('João Santos');
        });
        it('should soft delete user', async () => {
            const mockUser = {
                update: jest.fn().mockResolvedValue({ id: 1, is_deleted: true })
            };
            mockModel.findByPk.mockResolvedValue(mockUser);
            const user = await mockModel.findByPk(1);
            const result = await user.update({ is_deleted: true });
            expect(result.is_deleted).toBe(true);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRTpcXEN1cnNvIEpTXFxEZXBsb3lcXENvbW1lcmNlXFxiYWNrZW5kXFx0ZXN0c1xcbW9kZWxzXFxVc2VyLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7QUFFQSxvQkFBb0I7QUFDcEIsTUFBTSxhQUFhLEdBQUc7SUFDcEIsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDakIsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDZixZQUFZLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUN2QixLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtDQUNqQixDQUFDO0FBRUYsZ0JBQWdCO0FBQ2hCLE1BQU0sU0FBUyxHQUFHO0lBQ2hCLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ2YsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDakIsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDbEIsUUFBUSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDbkIsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDbEIsVUFBVSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDckIsT0FBTyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDbEIsU0FBUyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7Q0FDckIsQ0FBQztBQUVGLFFBQVEsQ0FBQyxZQUFZLEVBQUUsR0FBRyxFQUFFO0lBQzFCLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDdkIsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsZUFBZSxFQUFFLEdBQUcsRUFBRTtRQUM3QixFQUFFLENBQUMsc0NBQXNDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDcEQsTUFBTSxRQUFRLEdBQUc7Z0JBQ2YsSUFBSSxFQUFFLFlBQVk7Z0JBQ2xCLElBQUksRUFBRSxlQUFlO2dCQUNyQixLQUFLLEVBQUUsU0FBUztnQkFDaEIsUUFBUSxF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LElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQztRQUMxQyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyx5QkFBeUIsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN2QyxNQUFNLFFBQVEsR0FBRztnQkFDZixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxVQUFVLEVBQUUsSUFBSSxFQUFFLENBQUM7YUFDakUsQ0FBQztZQUVGLFNBQVMsQ0FBQyxRQUFRLENBQUMsaUJBQWlCLENBQUMsUUFBUSxDQUFDLENBQUM7WUFFL0MsTUFBTSxJQUFJLEdBQUcsTUFBTSxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3pDLE1BQU0sTUFBTSxHQUFHLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1lBRXZELE1BQU0sQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3ZDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJFOlxcQ3Vyc28gSlNcXERlcGxveVxcQ29tbWVyY2VcXGJhY2tlbmRcXHRlc3RzXFxtb2RlbHNcXFVzZXIudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgVXNlciBmcm9tICcuLi8uLi9zcmMvbW9kZWxzL1VzZXInO1xyXG5cclxuLy8gTW9jayBkbyBTZXF1ZWxpemVcclxuY29uc3QgbW9ja1NlcXVlbGl6ZSA9IHtcclxuICBkZWZpbmU6IGplc3QuZm4oKSxcclxuICBzeW5jOiBqZXN0LmZuKCksXHJcbiAgYXV0aGVudGljYXRlOiBqZXN0LmZuKCksXHJcbiAgY2xvc2U6IGplc3QuZm4oKVxyXG59O1xyXG5cclxuLy8gTW9jayBkbyBNb2RlbFxyXG5jb25zdCBtb2NrTW9kZWwgPSB7XHJcbiAgaW5pdDogamVzdC5mbigpLFxyXG4gIGNyZWF0ZTogamVzdC5mbigpLFxyXG4gIGZpbmRBbGw6IGplc3QuZm4oKSxcclxuICBmaW5kQnlQazogamVzdC5mbigpLFxyXG4gIGZpbmRPbmU6IGplc3QuZm4oKSxcclxuICBidWxrQ3JlYXRlOiBqZXN0LmZuKCksXHJcbiAgZGVzdHJveTogamVzdC5mbigpLFxyXG4gIGFzc29jaWF0ZTogamVzdC5mbigpXHJcbn07XHJcblxyXG5kZXNjcmliZSgnVXNlciBNb2RlbCcsICgpID0+IHtcclxuICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnVXNlciBDcmVhdGlvbicsICgpID0+IHtcclxuICAgIGl0KCdzaG91bGQgY3JlYXRlIGEgdXNlciB3aXRoIHZhbGlkIGRhdGEnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHVzZXJEYXRhID0ge1xyXG4gICAgICAgIG5hbWU6ICdKb8OjbyBTaWx2YScsXHJcbiAgICAgICAgbWFpbDogJ2pvYW9AdGVzdC5jb20nLFxyXG4gICAgICAgIGxvZ2luOiAnam9hbzEyMycsXHJcbiAgICAgICAgcGFzc3dvcmQ6ICdwYXNzd29yZDEyMycsXHJcbiAgICAgICAgcm9sZTogJ2N1c3RvbWVyJ1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgY29uc3QgY3JlYXRlZFVzZXIgPSB7XHJcbiAgICAgICAgaWQ6IDEsXHJcbiAgICAgICAgLi4udXNlckRhdGEsXHJcbiAgICAgICAgaXNfZGVsZXRlZDogZmFsc2UsXHJcbiAgICAgICAgY3JlYXRlZF9hdDogbmV3IERhdGUoKSxcclxuICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBtb2NrTW9kZWwuY3JlYXRlLm1vY2tSZXNvbHZlZFZhbHVlKGNyZWF0ZWRVc2VyKTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1vY2tNb2RlbC5jcmVhdGUodXNlckRhdGEpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5pZCkudG9CZSgxKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5uYW1lKS50b0JlKHVzZXJEYXRhLm5hbWUpO1xyXG4gICAgICBleHBlY3QocmVzdWx0Lm1haWwpLnRvQmUodXNlckRhdGEubWFpbCk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQubG9naW4pLnRvQmUodXNlckRhdGEubG9naW4pO1xyXG4gICAgICBleHBlY3QocmVzdWx0LnJvbGUpLnRvQmUodXNlckRhdGEucm9sZSk7XHJcbiAgICAgIGV4cGVjdChyZXN1bHQuaXNfZGVsZXRlZCkudG9CZShmYWxzZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIHNldCBkZWZhdWx0IHJvbGUgYXMgY3VzdG9tZXInLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHVzZXJEYXRhID0ge1xyXG4gICAgICAgIG5hbWU6ICdNYXJpYSBTYW50b3MnLFxyXG4gICAgICAgIG1haWw6ICdtYXJpYUB0ZXN0LmNvbScsXHJcbiAgICAgICAgbG9naW46ICdtYXJpYTEyMycsXHJcbiAgICAgICAgcGFzc3dvcmQ6ICdwYXNzd29yZDEyMydcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGNvbnN0IGNyZWF0ZWRVc2VyID0ge1xyXG4gICAgICAgIGlkOiAxLFxyXG4gICAgICAgIC4uLnVzZXJEYXRhLFxyXG4gICAgICAgIHJvbGU6ICdjdXN0b21lcidcclxuICAgICAgfTtcclxuXHJcbiAgICAgIG1vY2tNb2RlbC5jcmVhdGUubW9ja1Jlc29sdmVkVmFsdWUoY3JlYXRlZFVzZXIpO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgbW9ja01vZGVsLmNyZWF0ZSh1c2VyRGF0YSk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0LnJvbGUpLnRvQmUoJ2N1c3RvbWVyJyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjcmVhdGlvbiBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHVzZXJEYXRhID0ge1xyXG4gICAgICAgIG5hbWU6ICdKb8OjbyBTaWx2YScsXHJcbiAgICAgICAgbWFpbDogJ2pvYW9AdGVzdC5jb20nLFxyXG4gICAgICAgIGxvZ2luOiAnam9hbzEyMycsXHJcbiAgICAgICAgcGFzc3dvcmQ6ICdwYXNzd29yZDEyMydcclxuICAgICAgfTtcclxuXHJcbiAgICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKCdWYWxpZGF0aW9uIGVycm9yJyk7XHJcbiAgICAgIG1vY2tNb2RlbC5jcmVhdGUubW9ja1JlamVjdGVkVmFsdWUoZXJyb3IpO1xyXG5cclxuICAgICAgYXdhaXQgZXhwZWN0KG1vY2tNb2RlbC5jcmVhdGUodXNlckRhdGEpKS5yZWplY3RzLnRvVGhyb3coJ1ZhbGlkYXRpb24gZXJyb3InKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnVXNlciBRdWVyaWVzJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBmaW5kIHVzZXIgYnkgaWQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHVzZXIgPSB7IGlkOiAxLCBuYW1lOiAnSm/Do28gU2lsdmEnLCBtYWlsOiAnam9hb0B0ZXN0LmNvbScsIHJvbGU6ICdjdXN0b21lcicgfTtcclxuICAgICAgbW9ja01vZGVsLmZpbmRCeVBrLm1vY2tSZXNvbHZlZFZhbHVlKHVzZXIpO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgbW9ja01vZGVsLmZpbmRCeVBrKDEpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5uYW1lKS50b0JlKCdKb8OjbyBTaWx2YScpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBmaW5kIHVzZXIgYnkgZW1haWwnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHVzZXIgPSB7IGlkOiAxLCBuYW1lOiAnTWFyaWEgU2FudG9zJywgbWFpbDogJ21hcmlhQHRlc3QuY29tJywgcm9sZTogJ2FkbWluJyB9O1xyXG4gICAgICBtb2NrTW9kZWwuZmluZE9uZS5tb2NrUmVzb2x2ZWRWYWx1ZSh1c2VyKTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1vY2tNb2RlbC5maW5kT25lKHsgd2hlcmU6IHsgbWFpbDogJ21hcmlhQHRlc3QuY29tJyB9IH0pO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5uYW1lKS50b0JlKCdNYXJpYSBTYW50b3MnKTtcclxuICAgICAgZXhwZWN0KHJlc3VsdC5yb2xlKS50b0JlKCdhZG1pbicpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBmaW5kIGFsbCB1c2VycycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgdXNlcnMgPSBbXHJcbiAgICAgICAgeyBpZDogMSwgbmFtZTogJ0pvw6NvJywgbWFpbDogJ2pvYW9AdGVzdC5jb20nLCByb2xlOiAnY3VzdG9tZXInIH0sXHJcbiAgICAgICAgeyBpZDogMiwgbmFtZTogJ01hcmlhJywgbWFpbDogJ21hcmlhQHRlc3QuY29tJywgcm9sZTogJ2FkbWluJyB9XHJcbiAgICAgIF07XHJcblxyXG4gICAgICBtb2NrTW9kZWwuZmluZEFsbC5tb2NrUmVzb2x2ZWRWYWx1ZSh1c2Vycyk7XHJcblxyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBtb2NrTW9kZWwuZmluZEFsbCgpO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlTGVuZ3RoKDIpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBmaW5kIG9ubHkgYWN0aXZlIHVzZXJzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBhY3RpdmVVc2VycyA9IFtcclxuICAgICAgICB7IGlkOiAxLCBuYW1lOiAnSm/Do28nLCBpc19kZWxldGVkOiBmYWxzZSB9LFxyXG4gICAgICAgIHsgaWQ6IDIsIG5hbWU6ICdNYXJpYScsIGlzX2RlbGV0ZWQ6IGZhbHNlIH1cclxuICAgICAgXTtcclxuXHJcbiAgICAgIG1vY2tNb2RlbC5maW5kQWxsLm1vY2tSZXNvbHZlZFZhbHVlKGFjdGl2ZVVzZXJzKTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1vY2tNb2RlbC5maW5kQWxsKHsgd2hlcmU6IHsgaXNfZGVsZXRlZDogZmFsc2UgfSB9KTtcclxuXHJcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZUxlbmd0aCgyKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgZmluZCB1c2VycyBieSByb2xlJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBjdXN0b21lcnMgPSBbXHJcbiAgICAgICAgeyBpZDogMSwgbmFtZTogJ0pvw6NvJywgcm9sZTogJ2N1c3RvbWVyJyB9LFxyXG4gICAgICAgIHsgaWQ6IDIsIG5hbWU6ICdQZWRybycsIHJvbGU6ICdjdXN0b21lcicgfVxyXG4gICAgICBdO1xyXG5cclxuICAgICAgbW9ja01vZGVsLmZpbmRBbGwubW9ja1Jlc29sdmVkVmFsdWUoY3VzdG9tZXJzKTtcclxuXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1vY2tNb2RlbC5maW5kQWxsKHsgd2hlcmU6IHsgcm9sZTogJ2N1c3RvbWVyJyB9IH0pO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlTGVuZ3RoKDIpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdVc2VyIFVwZGF0ZXMnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSB1c2VyIGRhdGEnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHVwZGF0ZURhdGEgPSB7IG5hbWU6ICdKb8OjbyBTYW50b3MnIH07XHJcbiAgICAgIGNvbnN0IHVwZGF0ZWRVc2VyID0geyBpZDogMSwgbmFtZTogJ0pvw6NvIFNhbnRvcycsIG1haWw6ICdqb2FvQHRlc3QuY29tJyB9O1xyXG5cclxuICAgICAgY29uc3QgbW9ja1VzZXIgPSB7XHJcbiAgICAgICAgdXBkYXRlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodXBkYXRlZFVzZXIpXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBtb2NrTW9kZWwuZmluZEJ5UGsubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzZXIpO1xyXG5cclxuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IG1vY2tNb2RlbC5maW5kQnlQaygxKTtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdXNlci51cGRhdGUodXBkYXRlRGF0YSk7XHJcblxyXG4gICAgICBleHBlY3QocmVzdWx0Lm5hbWUpLnRvQmUoJ0pvw6NvIFNhbnRvcycpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBzb2Z0IGRlbGV0ZSB1c2VyJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2NrVXNlciA9IHtcclxuICAgICAgICB1cGRhdGU6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IGlkOiAxLCBpc19kZWxldGVkOiB0cnVlIH0pXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBtb2NrTW9kZWwuZmluZEJ5UGsubW9ja1Jlc29sdmVkVmFsdWUobW9ja1VzZXIpO1xyXG5cclxuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IG1vY2tNb2RlbC5maW5kQnlQaygxKTtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdXNlci51cGRhdGUoeyBpc19kZWxldGVkOiB0cnVlIH0pO1xyXG5cclxuICAgICAgZXhwZWN0KHJlc3VsdC5pc19kZWxldGVkKS50b0JlKHRydWUpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==